# Detection Engineering & Dashboards

This document details the process of moving from data collection to active threat detection. Using the ingested logs from the Linux and Windows endpoints, this phase focuses on writing **Splunk Processing Language (SPL)** queries to identify suspicious activity, creating dashboards for visualization, and setting up alerts.

---
## 1. Use Case: Detecting Brute-Force Activity on Linux

The first detection use case focuses on identifying potential SSH brute-force attacks against the Linux endpoint. This is a common attack vector where an adversary attempts to guess user credentials repeatedly.

### 1.1 - Data Generation
To ensure the detection query was effective, realistic log data was generated by simulating several failed SSH login attempts on the Linux host.

<img width="654" height="441" alt="image" src="https://github.com/user-attachments/assets/b951e6bd-5353-4a06-b727-eb6363522aeb" />

### 1.2 - Detection Query Development
The following SPL query was developed to find and aggregate these failed login events. A key step in this process was using the `rex` command to manually extract the `user` and `src_ip` fields, as they were not automatically identified by Splunk.

```spl
index="main" sourcetype="linux_secure" "Failed password for"
| rex "Failed password for(?: invalid user)? (?<user>\S+) from (?<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"
| stats count by user src_ip
| rename src_ip as "Source IP", user as "Username"
| sort -count
```

* **`rex`**: Extracts the username and source IP from the raw log text.
* **`stats`**: Counts the number of failures and groups them by the newly extracted fields.
* **`rename` / `sort`**: Cleans up the column names and sorts the results to show the most frequent attempts at the top.

The successful query results are shown below on the "Statistics" tab.

<img width="957" height="502" alt="image" src="https://github.com/user-attachments/assets/efa9a308-a2e8-4bea-bd33-8643eccd35a2" />

### 1.3 - Operationalizing the Detection
To make this detection useful for daily monitoring, the query was operationalized.

First, the successful search was saved as a **Report** named "Linux - Failed SSH Login Attempts".

<img width="960" height="325" alt="image" src="https://github.com/user-attachments/assets/a10590f3-0a2d-4c95-bb0d-452ebc938ca6" />

Next, the report was added as a new panel to a **Dashboard** titled "SOC Overview". This provides at-a-glance visibility of potential brute-force activity for a SOC analyst.

<img width="943" height="507" alt="image" src="https://github.com/user-attachments/assets/83c9e800-099c-454f-80db-59945eb0e892" />
